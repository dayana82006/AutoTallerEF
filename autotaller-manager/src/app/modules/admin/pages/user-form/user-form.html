<div class="container py-5" style="max-width: 600px; margin-top: 80px;">
  <h2 class="mb-4 text-white">
    {{ isEditMode ? 'Editar Usuario' : 'Nuevo Usuario' }}
  </h2>
  
  <p class="text-white" *ngIf="isEditMode && editingId !== null">
    <strong>ID:</strong> {{ editingId }}
  </p>

  <!-- Agregar referencia del template para validación -->
  <form #userForm="ngForm" (ngSubmit)="saveUser()">
    <div class="mb-3">
      <label class="form-label text-white">Nombre *</label>
      <input 
        class="form-control" 
        [(ngModel)]="user.name" 
        name="name" 
        #name="ngModel"
        required 
        minlength="2"
        [class.is-invalid]="name.invalid && name.touched"
      />
      <div class="invalid-feedback" *ngIf="name.invalid && name.touched">
        <div *ngIf="name.errors?.['required']">El nombre es requerido</div>
        <div *ngIf="name.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label text-white">Apellido *</label>
      <input 
        class="form-control" 
        [(ngModel)]="user.lastname" 
        name="lastname" 
        #lastname="ngModel"
        required 
        minlength="2"
        [class.is-invalid]="lastname.invalid && lastname.touched"
      />
      <div class="invalid-feedback" *ngIf="lastname.invalid && lastname.touched">
        <div *ngIf="lastname.errors?.['required']">El apellido es requerido</div>
        <div *ngIf="lastname.errors?.['minlength']">El apellido debe tener al menos 2 caracteres</div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label text-white">Correo *</label>
      <input 
        type="email" 
        class="form-control" 
        [(ngModel)]="user.email" 
        name="email" 
        #email="ngModel"
        required 
        email
        [class.is-invalid]="email.invalid && email.touched"
      />
      <div class="invalid-feedback" *ngIf="email.invalid && email.touched">
        <div *ngIf="email.errors?.['required']">El correo es requerido</div>
        <div *ngIf="email.errors?.['email']">Ingresa un correo válido</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="role" class="form-label text-white">Rol *</label>
      <select 
        [(ngModel)]="user.role" 
        class="form-select" 
        name="role" 
        id="role"
        #role="ngModel"
        required
        [class.is-invalid]="role.invalid && role.touched"
      >
        <option value="">Selecciona un rol</option>
        <option value="Admin">Administrador</option>
        <option value="Recepcionista">Recepcionista</option>
        <option value="Mecánico">Mecánico</option>
      </select>
      <div class="invalid-feedback" *ngIf="role.invalid && role.touched">
        <div *ngIf="role.errors?.['required']">Debes seleccionar un rol</div>
      </div>
    </div>

    <div class="mb-3" *ngIf="user.role === 'Mecánico'">
      <label class="form-label text-white">Especialidades</label>
      <div *ngFor="let spec of availableSpecialties" class="form-check">
        <input
          type="checkbox"
          class="form-check-input"
          [id]="spec"
          [checked]="user.specialties.includes(spec)"
          (change)="toggleSpecialty(spec)"
        />
        <label class="form-check-label text-white" [for]="spec">{{ spec }}</label>
      </div>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <button 
        class="btn btn-primary" 
        type="submit"
        [disabled]="userForm.invalid"
      >
        {{ isEditMode ? 'Actualizar' : 'Crear' }} Usuario
      </button>
      <button class="btn btn-secondary" type="button" (click)="cancel()">
        Cancelar
      </button>
    </div>
  </form>
</div>