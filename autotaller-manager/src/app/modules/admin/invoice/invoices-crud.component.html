<div class="container py-4">
  <h2 class="mb-3 text-center title">Gesti√≥n de Facturas</h2>

  <div class="container mt-4">
    <div class="row g-2 align-items-center">
      <div class="col-md-12">
        <div class="input-group">
          <span class="input-group-text bg-dark border-secondary text-white">
            <i class="bi bi-search"></i>
          </span>
          <input type="text" class="form-control bg-dark text-white border-secondary" [(ngModel)]="search"
            (ngModelChange)="onSearchChange()" placeholder="Buscar por cliente o monto" />
        </div>
      </div>
    </div>
  </div>

  <div class="table-responsive mb-5 mt-3">
    <table class="table table-dark table-striped table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Repuestos</th>
          <th>Servicios</th>
          <th>Total</th><th *ngIf="authService.currentUser?.role?.includes('Admin')">Creado</th>

          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let inv of invoices">
          <td>{{ inv.id }}</td>
          <td>{{ getClientName(inv.clientId) }}</td>
          <td>${{ inv.totalSpares | number: '1.0-0' }}</td>
          <td>${{ inv.totalServices | number: '1.0-0' }}</td>
          <td>${{ inv.finalAmount | number: '1.0-0' }}</td>
          <td *ngIf="authService.currentUser?.role?.includes('Admin')">
            {{ inv.createdAt | date: 'short' }}
          </td>

          <td>
            <button class="btn btn-sm btn-outline-danger" (click)="delete(inv.id)">
              Eliminar
            </button>
          </td>
        </tr>
        <tr *ngIf="invoices.length === 0">
          <td [attr.colspan]="authService.hasRole('Admin') ? 7 : 6" class="text-center text-secondary">
            No hay facturas
          </td>

        </tr>
      </tbody>
    </table>
  </div>

  <div #formSection class="d-flex justify-content-center">
    <div class="card bg-dark text-white p-4" style="width: 100%; max-width: 500px">
      <h4 class="title mb-4">Nueva Factura</h4>

      <form #invoiceForm="ngForm" (ngSubmit)="save()" novalidate>
        <div class="mb-3">
          <label class="form-label">Cliente</label>
          <select class="form-select" [(ngModel)]="newInvoice.clientId" name="clientId" required>
            <option [ngValue]="0" disabled>Seleccione un cliente</option>
            <option *ngFor="let client of clients" [ngValue]="client.id">
              {{ client.name }} (ID: {{ client.id }})
            </option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Total Repuestos</label>
          <input type="number" class="form-control" [(ngModel)]="newInvoice.totalSpares" name="totalSpares" required
            min="0" />
        </div>

        <div class="mb-3">
          <label class="form-label">Total Servicios</label>
          <input type="number" class="form-control" [(ngModel)]="newInvoice.totalServices" name="totalServices" required
            min="0" />
        </div>

        <div class="mb-3">
          <label class="form-label">Monto Final</label>
          <input type="number" class="form-control" [(ngModel)]="newInvoice.finalAmount" name="finalAmount" required
            min="0" />
        </div>

        <div class="d-flex justify-content-end">
          <button type="submit" class="btn btn-primary" [disabled]="invoiceForm.invalid">
            Crear
          </button>
        </div>
      </form>
    </div>
  </div>
</div>